<div *ngIf="isLoading" class="loader fade-in">
  <span class="spinner"></span> –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏...
</div>

<div *ngIf="isForbidden && !isLoading" class="unauthorized fade-in">
  ‚õî –ù—è–º–∞—Ç–µ –¥–æ—Å—Ç—ä–ø –¥–æ —Ç–∞–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞.
</div>

<div *ngIf="!isForbidden && !isLoading" class="users-container fade-in">
  <h2>üë• –°–ø–∏—Å—ä–∫ —Å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h2>

  <!-- üîç –¢—ä—Ä—Å–µ–Ω–µ -->
  <div class="search-bar">
    <input type="text"
           [(ngModel)]="searchTerm"
           placeholder="üîç –¢—ä—Ä—Å–∏ –ø–æ email –∏–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª..."
           class="search-input" />
  </div>

  <!-- üìã –¢–∞–±–ª–∏—Ü–∞ -->
  <table class="users-table" *ngIf="filteredUsers.length > 0; else noUsers">
    <thead>
      <tr>
        <th>#</th>
        <th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</th>
        <th>Email</th>
        <th>–†–æ–ª—è</th>
        <th class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of filteredUsers; index as i"
          [ngClass]="{ 'self-row': user._id === currentUserId }"
          class="fade-in">
        <td>{{ i + 1 }}</td>
        <td>
          {{ user.username }}
          <div class="user-id">üÜî {{ user._id.slice(-6) }}</div>
        </td>
        <td>{{ user.email }}</td>
        <td>
          <span [ngClass]="{
              'badge-admin': user.role === 'admin',
              'badge-user': user.role === 'user'
            }">
            {{ user.role }}
          </span>
        </td>
        <td class="actions-cell">
          <ng-container *ngIf="currentUserRole === 'admin' && user._id !== currentUserId">
            <button *ngIf="user.role === 'user'"
                    (click)="confirmRoleChange(user._id, 'admin')"
                    class="btn-role promote"
                    title="–ù–∞–∑–Ω–∞—á–∏ –∑–∞ –∞–¥–º–∏–Ω">
              ‚¨ÜÔ∏è
            </button>
            <button *ngIf="user.role === 'admin'"
                    (click)="confirmRoleChange(user._id, 'user')"
                    class="btn-role demote"
                    title="–ü—Ä–µ–º–∞—Ö–Ω–∏ –∞–¥–º–∏–Ω">
              ‚¨áÔ∏è
            </button>
            <button (click)="goToEditUser(user._id)"
                    class="btn-edit"
                    title="–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª">
              ‚úèÔ∏è
            </button>
          </ng-container>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ‚ùå –ù—è–º–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ -->
  <ng-template #noUsers>
    <p class="no-users-msg">‚ùó –ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏.</p>
  </ng-template>
</div>
