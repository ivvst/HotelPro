<div class="card">
  <h2>Cruises</h2>
  <button (click)="addCruise()">Add Cruise</button>



  <!-- Ако няма избран круиз: Показваме таблицата -->

  <div *ngIf="!selectedCruise()">

    <table class="cruise-table">
      <thead>
        <div *ngIf="loader.loading$ | async" class="loading-overlay">
          <p>Зареждане...</p>
        </div>
        <tr>
          <th>Cruise</th>
          <th>Excursions</th>
          <th>Guests</th>
          <th>Fill %</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cruise of pagedCruises(); trackBy: trackById">
          <td>{{ cruise.name }}</td>
          <td>{{ getExcursionCount(cruise) }}</td>
          <td>{{ getGuestCount(cruise._id) }} / {{ MAX_GUESTS }}</td>
          <td>
            <div class="progress-bar-wrapper">
              <div class="progress-bar" [style.width.%]="getFilledPercent(cruise._id)"></div>
            </div>
            <span>{{ getFilledPercent(cruise._id) }}%</span>
          </td>
          <td>
            <button (click)="checkGuests(cruise._id)">Show guests</button>
            <button (click)="showDetails(cruise)">Details</button>

          </td>
        </tr>
      </tbody>
    </table>
    <nav class="pagination" *ngIf="totalPages() > 1">
      <button (click)="prevPage()" [disabled]="page() === 1">&laquo; Prev</button>
      <ng-container *ngFor="let p of [].constructor(totalPages()); let i = index">
        <button (click)="setPage(i+1)" [class.active]="page() === (i+1)">
          {{ i+1 }}
        </button>
      </ng-container>
      <button (click)="nextPage()" [disabled]="page() === totalPages()">Next &raquo;</button>
    </nav>
  </div>

  <!-- Ако има избран круиз: Показваме детайлите -->
  <div *ngIf="selectedCruise()" class="cruise-details">
    <div class="cd-header">
      <div class="cd-title">
        <h3>{{ selectedCruise()!.name }}</h3>
        <span class="cd-badge">ID: {{ selectedCruise()!._id }}</span>
      </div>
      <div class="cd-actions">
        <button *ngIf="!editMode" class="btn btn-edit" (click)="startEdit(selectedCruise()!)">Редактирай</button>
        <button class="btn btn-danger" (click)="confirmDeleteCruise(selectedCruise()!)">Изтрий</button>
        <button class="btn btn-ghost" (click)="backToCruises()">Назад</button>
      </div>
    </div>

    <div class="cd-grid">
      <div class="cd-card">
        <div class="cd-label">Период</div>
        <div class="cd-value">
          {{ selectedCruise()!.startDate }} – {{ selectedCruise()!.endDate }}
        </div>
      </div>

      <div class="cd-card">
        <div class="cd-label">Екскурзии</div>
        <div class="cd-value">{{ getExcursionCount(selectedCruise()!) }}</div>
      </div>

      <div class="cd-card">
        <div class="cd-label">Гости</div>
        <div class="cd-value">{{ getGuestCount(selectedCruise()!._id) }} / {{ MAX_GUESTS }}</div>
        <div class="cd-progress">
          <div class="cd-progress-bar" [style.width.%]="getFilledPercent(selectedCruise()!._id)"></div>
        </div>
        <div class="cd-progress-num">{{ getFilledPercent(selectedCruise()!._id) }}%</div>
      </div>
    </div>

    <!-- Форма за редакция (ако е активирана) -->
    <form *ngIf="editMode" class="cd-form" (ngSubmit)="saveEdit()">
      <div class="row">
        <label for="cd-name">Име</label>
        <input id="cd-name" type="text" [(ngModel)]="editModel.name" name="name" required />
      </div>
      <div class="row">
        <label for="cd-start">Начало</label>
        <input id="cd-start" type="date" [(ngModel)]="editModel.startDate" name="startDate" />
      </div>
      <div class="row">
        <label for="cd-end">Край</label>
        <input id="cd-end" type="date" [(ngModel)]="editModel.endDate" name="endDate" />
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-edit" [disabled]="saving">Запази</button>
        <button type="button" class="btn btn-ghost" (click)="cancelEdit()" [disabled]="saving">Отказ</button>
      </div>
    </form>

    <h4 class="cd-subtitle">Екскурзии към круиза</h4>
    <app-excursion-list [cruiseId]="selectedCruise()!._id"></app-excursion-list>
  </div>


</div>



<!-- 
 Pagination controls showing after certain amount of Cruises
  <nav class="pagination" *ngIf="totalPages() > 1">
    <button (click)="prevPage()" [disabled]="page() === 1">&laquo; Prev</button>
    <ng-container *ngFor="let p of [].constructor(totalPages()); let i = index">
      <button (click)="setPage(i+1)" [class.active]="page() === (i+1)">
        {{ i+1 }}
      </button>
    </ng-container>
    <button (click)="nextPage()" [disabled]="page() === totalPages()">Next &raquo;</button>
  </nav>
</div> -->