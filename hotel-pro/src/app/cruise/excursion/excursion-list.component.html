<table *ngIf="excursions.length" class="exc-table">
  <thead class="exc-thead">
    <tr>
      <th>–ò–º–µ</th>
      <th>–î–∞—Ç–∞</th>
      <th>–û—Ç</th>
      <th>–î–æ</th>
      <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
      <th class="th-actions">–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>

  <tbody>
    <ng-container *ngFor="let ex of excursions">
      <tr class="exc-row" [class.row-flagged]="ex.deleteRequested">
        <td>
          <div class="ex-title">
            <span class="ex-name">{{ ex.name }}</span>
            <span *ngIf="ex.deleteRequested" class="chip chip-danger" title="–ú–∞—Ä–∫–∏—Ä–∞–Ω–∞ –∑–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ">‚õî –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ</span>
          </div>

          <!-- –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–¥ –∏–º–µ—Ç–æ -->
          <div class="x-metrics">
            <span class="cap chip chip-info">–ö–∞–ø–∞—Ü–∏—Ç–µ—Ç: {{ ex.capacity ?? 0 }}</span>
            <span class="wl chip chip-warn">–ß–∞–∫–∞—â–∏: {{ ex.waitlist?.length || 0 }}</span>
          </div>
        </td>

        <td class="nowrap">{{ ex.date ? (ex.date | date:'dd/MM/yyyy') : '-' }}</td>
        <td class="nowrap">{{ ex.fromTime || '-' }}</td>
        <td class="nowrap">{{ ex.toTime || '-' }}</td>
        <td>
          <span class="desc" [title]="ex.description || '-'">{{ (ex.description || '-') | shorten:80 }}</span>
        </td>

        <td>
          <div class="exc-actions">
            <button *ngIf="isAdmin" class="btn btn-edit" (click)="startEdit(ex)" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π">
              ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π
            </button>

            <button *ngIf="isAdmin" class="btn btn-danger" (click)="deleteExcursion(ex._id!)" aria-label="–ò–∑—Ç—Ä–∏–π">
              üóëÔ∏è –ò–∑—Ç—Ä–∏–π
            </button>

            <button *ngIf="ex.deleteRequested && isAdmin" class="btn btn-warning"
                    (click)="rejectDelete(ex._id)" aria-label="–û—Ç–∫–∞–∂–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ">
              ‚Ü© –û—Ç–∫–∞–∂–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ
            </button>

            <button *ngIf="!isAdmin && !ex.deleteRequested" class="btn btn-ghost"
                    (click)="requestDelete(ex._id)" aria-label="–ú–∞—Ä–∫–∏—Ä–∞–π –∑–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ">
              ‚õî –ú–∞—Ä–∫–∏—Ä–∞–π –∑–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ
            </button>

            <span *ngIf="!isAdmin && ex.deleteRequested" class="flag-delete-text">–ò–∑—á–∞–∫–≤–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ</span>
          </div>

          <div class="row-actions">
            <button class="btn btn-secondary" (click)="toggleGuests(ex._id)" aria-label="–ü–æ–∫–∞–∂–∏ –≥–æ—Å—Ç–∏">
              üë• –ì–æ—Å—Ç–∏
            </button>

            <!-- –ò–Ω–ª–∞–π–Ω —Å–º—è–Ω–∞ –Ω–∞ –∫–∞–ø–∞—Ü–∏—Ç–µ—Ç (—Å–∞–º–æ –∑–∞ –∞–¥–º–∏–Ω) -->
            <div *ngIf="isAdmin" class="cap-inline">
              <label class="cap-label" for="cap-{{ ex._id }}">–ö–∞–ø–∞—Ü–∏—Ç–µ—Ç:</label>
              <input id="cap-{{ ex._id }}" type="number" min="1" max="999"
                     class="capacity-input"
                     [value]="ex.capacity || 1"
                     (change)="saveCapacity(ex, $event)" />
            </div>
          </div>
        </td>
      </tr>

      <!-- –†–µ–¥ —Å –≥–æ—Å—Ç–∏—Ç–µ -->
      <tr *ngIf="expanded[ex._id || '']">
        <td colspan="6">
          <div *ngIf="loadingGuests[ex._id || '']" class="loading-overlay">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≥–æ—Å—Ç–∏...</div>

          <div *ngIf="errorByExcursion[ex._id || '']" class="error">
            {{ errorByExcursion[ex._id || ''] }}
          </div>

          <ul *ngIf="guestsByExcursion[ex._id || '']?.length" class="guest-list">
            <li *ngFor="let g of guestsByExcursion[ex._id || '']">
              {{ g.firstName }} {{ g.lastName }} <span class="muted">(–°—Ç–∞—è: {{ g.roomNumber || 'N/A' }})</span>
            </li>
          </ul>

          <div *ngIf="!guestsByExcursion[ex._id || '']?.length && !loadingGuests[ex._id || '']" class="empty">
            –ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ –≥–æ—Å—Ç–∏ –∑–∞ —Ç–∞–∑–∏ –µ–∫—Å–∫—É—Ä–∑–∏—è.
          </div>
        </td>
      </tr>
    </ng-container>
  </tbody>
</table>
